<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Flight Manual v8.5.1</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Import Map -->
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "lucide-react": "https://esm.sh/lucide-react@0.263.1"
        }
    }
    </script>

    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { 
            background-color: #0f172a; 
            color: #e2e8f0; 
            -webkit-tap-highlight-color: transparent; 
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        }
        .scan-line { 
            position: fixed; top: 0; left: 0; width: 100%; height: 2px; 
            background: rgba(56, 189, 248, 0.3); 
            animation: scan 3s linear infinite; pointer-events: none; z-index: 50; opacity: 0.3; 
        }
        @keyframes scan { 0% { transform: translateY(-100vh); } 100% { transform: translateY(100vh); } }
        
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.1); }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(56, 189, 248, 0.3); border-radius: 2px; }

        /* Animation Utilities */
        .animate-in { animation-duration: 0.5s; animation-fill-mode: both; }
        .fade-in { animation-name: fadeIn; }
        .slide-in-from-bottom-4 { animation-name: slideInFromBottom; }
        .slide-in-from-top-1 { animation-name: slideInFromTop; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideInFromBottom { from { transform: translateY(1rem); } to { transform: translateY(0); } }
        @keyframes slideInFromTop { from { transform: translateY(-0.5rem); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            BookOpen, Sun, Coffee, Activity, Moon, Globe, ClipboardCheck, 
            CheckSquare, PlaneTakeoff, PlaneLanding, Layout, Cpu, Bug, 
            Zap, Map, Eye, Shield, Server, CheckCircle, AlertCircle,
            Box, Layers, AlignLeft, Grid, User, GitBranch, Terminal, Scroll, Database, History, Fingerprint, Lock, Flame, Plane, Mountain, Compass, HelpCircle, HeartPulse, Anchor, MapPin, HeartHandshake, Users, ArrowUpCircle, Target, ShieldCheck, Sparkles, Check, Globe2, Dumbbell, Info, Wrench, FileText, Link, BatteryCharging, BrainCircuit, Headphones, Sofa, CalendarClock, ArrowRight, PenTool, ChevronDown, ChevronUp
        } from 'lucide-react';

        // --- Data Definitions ---

        const phases = [
            { id: "deepWork", time: "09:00 - 12:00", title: "高空巡航 (深度工作)", color: "text-emerald-400", icon: Sun, desc: "黃金時段。大腦最乾淨、邏輯最強。", dos: ["資料分析", "系統建構", "策略規劃"], donts: ["開會", "社交", "行政雜事", "情緒勞動"] },
            { id: "refuel", time: "12:00 - 14:00", title: "空中加油 (能量恢復)", color: "text-amber-400", icon: Coffee, desc: "系統冷卻期。主推進器脫離。", dos: ["獨自吃飯", "散步/自然", "安靜", "無輸入模式"], donts: ["社交午餐", "回答問題", "深度思考"] },
            { id: "maneuver", time: "14:00 - 16:00", title: "低空應變 (回應模式)", color: "text-cyan-400", icon: Activity, desc: "次級深度。適合例行公事與維護作業。", dos: ["回覆郵件/訊息", "例行報告", "資料清洗", "進度追蹤"], donts: ["啟動大型新專案", "高風險決策"] },
            { id: "rest", time: "16:00 +", title: "停機歸位 (系統關閉)", color: "text-indigo-400", icon: Moon, desc: "完全關機。回到基地修復。", dos: ["空間 Reset", "料理/滋養", "個人研究", "睡眠"], donts: ["工作訊息", "煩惱明天", "藍光刺激"] }
        ];

        const specs = [
            { 
                title: "核心引擎：MG 薦骨動力", 
                icon: Zap, 
                color: "text-orange-400", 
                desc: "非線性、爆發型能量。嚴禁強制啟動，需等待「回應」點火。適合短時間高強度衝刺，必須搭配頻繁的冷卻重置。",
                link: "PILOT > CORE > KERNEL LAYER"
            },
            { 
                title: "導航系統：學者型雷達", 
                icon: Map, 
                color: "text-indigo-400", 
                desc: "高度依賴「視覺化地圖」。需要「大地圖」提供安全感，但需要「開放領空」進行自由探索。邏輯與結構是系統安定的關鍵。",
                link: "PILOT > PATH > CAREER & SIDE QUESTS"
            },
            { 
                title: "燃料系統：視覺化庫存", 
                icon: Eye, 
                color: "text-cyan-400", 
                desc: "視覺協議與空間動線。建立「零阻力動線」（物品手伸即得）與「1+1 備品制」。維持桌面 80% 留白。看不見＝不存在，零雜物＝零焦慮。",
                link: "PILOT > MAINT > DAILY MAINTENANCE"
            },
            { 
                title: "裝甲護盾：4/6 高敏塗層", 
                icon: Shield, 
                color: "text-emerald-400", 
                desc: "需求：「低語境」互動（少人情、多規則）。「北歐」是心理座標而非地理座標。透過系統化管理，你能在任何地方建立自己的「虛擬北歐」。",
                link: "PILOT > MAINT > REMOTE CALIBRATION"
            },
            { 
                title: "主要任務：系統架構師", 
                icon: Server, 
                color: "text-rose-400", 
                desc: "將混亂轉化為秩序。核心職能：文件化 (Documentation)、後台運營 (Ops)、資料支援。非前線作戰單位，而是戰略骨幹。",
                link: "PILOT > PATH > CAREER NAVIGATION"
            }
        ];

        const diagnostics = [
            { obs: "對晨間日記/冥想毫無動力，雖是大眾推薦的好習慣。", analysis: "【引擎不相容】MG 引擎是「回應制」。面對空白紙張硬寫日記屬於「發起」，會導致引擎空轉。冥想要求關閉雷達，違反高敏偵測的天性。", fix: "改用「戰術板」：看著選項做反應（勾選/刪除），而非無中生有。" },
            { obs: "被評價為「難以掌握/難相處」，但我只是實事求是。", analysis: "【導航者特質】這不是 Bug，是導航系統的「自動校正」功能。系統優先級：事實 > 人情。當發現邏輯錯誤時，會本能拒絕執行錯誤指令。", fix: "接受設定：你是「參謀/架構師」，本來就不適合當盲從的兵。" },
            { obs: "不再糾結是否要搬去印度或北歐，人生有了新的盼頭。", analysis: "【系統已鎖定】這是內核升級的證明。你意識到「逃避（物理移動）」無法解決「能量過剩（心理焦慮）」的問題。唯有「構建系統（升維思考）」才是終極解法。", fix: "MISSION STATUS: COURSE LOCKED. 繼續保持當前航向，拒絕雜訊干擾。" }
        ];

        const checklistData = {
            takeoff: {
                t1: { text: '燃料補給', subtext: '檢查水份攝取' },
                t2: { text: '薦骨掃描', subtext: '確認能量存量' },
                t3: { text: '防護罩開啟', subtext: '降噪耳機 / 音樂' },
                t4: { text: '鎖定航向', subtext: '確認今日主線' },
            },
            landing: {
                l1: { text: '切斷訊號', subtext: '關閉通訊軟體' },
                l2: { text: '跑道淨空', subtext: '桌面物理歸零' },
                l3: { text: '機師彈射', subtext: '靈魂登出下班' },
            }
        };

        const pilotData = {
            core: {
                title: "核心代碼：雙核動力系統 (Dual-Core Propulsion)",
                desc: "命盤終極邏輯：你是一座「配備核動力泵浦的超級水利工程」。\n• 動力源 (Input)：壬子（核反應爐）提供無限動能。\n• 蓄能池 (Storage)：申子辰（高壓水庫）累積龐大勢能。\n• 轉換器 (Output)：你的唯一任務是建立「甲木發電機組（系統/架構）」。\n\n系統守則：焦慮源於「滿庫溢流」。靠「人治」會導致潰堤（情緒爆炸），唯有靠「機制」才能將恐怖的位能高效轉化為電力（價值）。",
                tags: ["Dual-Core Propulsion", "Nuclear Pump", "High-Pressure Reservoir"]
            },
            kernel: {
                title: "KERNEL LAYER (運算內核)：壬子羊刃",
                subtitle: "The Double-Edged Sword",
                desc: "日支「子」是壬水的「羊刃」。這裡是你能量的源頭。當門關起來或面臨決策時，靈活的乙木會退下，換上霸氣的壬水將軍。這是一把雙面刃：用得好是開疆闢土，用不好則傷人傷己。",
                attributes: [
                    { label: "超頻運作 (Overclocking)", value: "核心始終處於 High Frequency 狀態。意志力極強，決策邏輯具「不可逆性」。MG 般的焦慮感源於此處能量內爆。" },
                    { label: "Root 權限 (Autonomy)", value: "拒絕微觀管理 (Micro-management)。必須擁有完全的掌控權才能運作。無法忍受被低效率或無邏輯之人指揮。" },
                    { label: "強強聯手 (Alliance)", value: "夫妻宮坐羊刃。拒絕依賴與撒嬌。尋求能並肩作戰的隊友。弱者遭嫌棄，強者遭反擊（若意圖壓制）。" }
                ],
                solution: "【能量轉化協議】將水（焦慮/能量）導入木（系統/架構）。將「控制欲」轉化為「系統控制力」。"
            },
            maya: {
                title: "SOUL TOTEM (靈魂圖騰)：黃星星",
                desc: "瑪雅曆：Yellow Star (Lamat)。能量本質：「美麗、優雅、藝術」。這解釋了你對「混亂與醜陋」的零容忍。你的任務是將「理念」化為「實相」，把混亂的公司變成優雅的系統。",
                location: "智利 (Chile) / 安地斯山脈",
                meaning: "象徵「高海拔的清晰視野」。這不是叫你搬去智利，而是提醒你：做任何決定時，請用「美感」作為過濾器。如果是粗俗、混亂的，請遠離；如果是清晰、優雅的，請靠近。"
            },
            patches: {
                title: "SYSTEM PATCHES (系統補丁)",
                desc: "已修復的舊版 Bug 與思維邏輯更新。無需再為此消耗算力。",
                items: [
                    { 
                        bug: "對他人「不負責任」感到憤怒煩躁", 
                        fix: "判定為：零件故障 (Noise)", 
                        logic: "對方的人品問題是「外部故障」，不是你的系統錯誤。不需要動氣教育，只需啟動「SOP 隔離協議」。用規則排除，保持高壓電與低壓零件的絕緣。",
                        status: "PATCHED"
                    },
                    { 
                        bug: "對「還不會做的事」感到焦慮恐慌", 
                        fix: "判定為：升級任務 (Quest)", 
                        logic: "對於高運算核心（你）來說，焦慮＝飢餓感。這不是能力不足，是「CPU 需要數據」。立即開始學習 (Input)，焦慮會瞬間轉化為興奮動能。",
                        status: "PATCHED"
                    }
                ]
            },
            career: {
                title: "職涯定位：解決方案架構師",
                desc: "戰場在「商業邏輯」與「技術落地」的中間。不是砌磚頭的工程師 (Builder)，而是畫藍圖的設計者 (Architect)。",
                comparison: [
                    { role: "工程師", feature: "被系統管理 / 寫 Code", status: "困龍 (煩躁/大材小用)" },
                    { role: "架構師", feature: "設計系統管理 / 畫藍圖", status: "通關 (成就/掌控全局)" }
                ],
                archetypes: [
                    { name: "都水使者", desc: "治理氾濫能量，建設水利工程 (李冰)" },
                    { name: "軍師祭酒", desc: "軍隊系統建立者，以軍法代人治 (諸葛亮)" },
                    { name: "工部尚書", desc: "國家建設總監，技術官僚權威" }
                ]
            },
            sideQuests: {
                title: "SIDE QUESTS (共鳴檢測)",
                desc: "為什麼你覺得這些「好酷」？因為它們是你內在程式碼的「實體版」投射。這證明你的「架構師」屬性是天生的。",
                items: [
                    { name: "城市設計 (Urban Design)", match: "95%", desc: "系統架構的物理版。規劃人流＝規劃資料流。證明你熱愛的是「宏觀秩序」。" },
                    { name: "古蹟修復 (Restoration)", match: "90%", desc: "重構舊代碼 (Refactoring)。證明你擁有讀懂前人邏輯（學者）與修復 Bug 的耐心。" },
                    { name: "供應鏈架構師 (Supply Chain)", match: "92%", desc: "物流版的水利工程。證明你擅長掌控複雜流動與突發狀況（將軍）。" }
                ]
            },
            decision: {
                title: "DECISION SUPPORT (決策輔助)",
                desc: "綜合運算後的最佳路徑規劃與心理建議。",
                cards: [
                    { 
                        title: "最佳路徑 (The Winner)", 
                        icon: Anchor, 
                        color: "text-emerald-400", 
                        bg: "bg-emerald-500/10",
                        border: "border-emerald-500/30",
                        content: "【RevOps / Solutions Architect】。這不是轉行，而是「進化」。直接繼承商業經驗（水），用技術（木）變現。阻力最小，成功率最高。" 
                    },
                    { 
                        title: "技能策略 (Skill Strategy)", 
                        icon: Layers, 
                        color: "text-amber-400", 
                        bg: "bg-amber-500/10",
                        border: "border-amber-500/30",
                        content: "【T型架構：深核廣用】。只需沈浸式投入「系統思維 (System Thinking)」。其他（Coding/城市設計）都是應用場景。不要當工具人，要當畫圖的人。" 
                    },
                    { 
                        title: "心理健康 (Mental Health)", 
                        icon: HeartPulse, 
                        color: "text-rose-400", 
                        bg: "bg-rose-500/10",
                        border: "border-rose-500/30",
                        content: "【反直覺診斷】高強度不是壓力，『低效與混亂』才是壓力。去「制度混亂」的公司會讓你生病；去「重視邏輯」的地方反而讓你平靜。你的藥方是「秩序」，不是「休息」。" 
                    }
                ]
            },
            alliance: {
                title: "ALLIANCE PROTOCOL (僚機協議)",
                desc: "夫妻宮坐羊刃。感情不是必需品，而是「戰略級的聯盟」。",
                strategies: [
                    { 
                        title: "強強聯手 (Power Couple)", 
                        icon: Users,
                        content: "你需要的不是「被照顧」，而是「被理解」。你需要一個能跟你比拼智力、能量對等的隊友。弱者會讓你感到厭煩，因為他們跟不上你的航速。" 
                    },
                    { 
                        title: "濾網理論 (The Filter)", 
                        icon: HeartHandshake,
                        content: "你的職業發展就是最好的「濾網」。如果你停在地面（低強度工作），你只會遇到地面的人。只有當你飛到「架構師」的高度，你才能在雷達上掃描到其他正在飛行的「僚機」。專注事業，就是對感情最大的負責。" 
                    },
                    { 
                        title: "高度法則 (Altitude Principle)", 
                        icon: ArrowUpCircle,
                        content: "飛得越高，亂流越少。當你達到平流層（架構師高度），工作與感情不再是「零和遊戲」（爭奪時間），而是「互補效應」（資源共享）。你的成就感會成為感情的燃料，而不是負擔。" 
                    }
                ]
            },
            duality: {
                title: "PROJECT: DUALITY (雙極計畫)",
                desc: "將旅行視為「系統升級專案」。這不是逃避，而是為了下載「環境參數」以校準內在系統。",
                tools: [
                    { 
                        name: "審計筆記本 (Audit Notebook)", 
                        desc: "戰略意義：Log File (日誌檔)。",
                        detail: "您的思緒是「大水」，流速快且容易發散。如果不把它記錄下來，這些洞見就會流失。這本筆記是用來「固化 (Solidify)」您在異地看到的秩序。在挪威，寫下「我可以刪掉什麼廢話會議？」(減法)；在智利，寫下「哪些是我絕對不妥協的底線？」(邊界)。這是建立「Not-To-Do List」的關鍵。",
                        icon: PenTool 
                    },
                    { 
                        name: "降噪耳機 (Noise-Cancelling)", 
                        desc: "戰略意義：Firewall (防火牆)。",
                        detail: "您的 4/6 人生角色對環境非常敏感。雜音會消耗 CPU 算力。耳機是物理開關：挪威模式(ON)戴上耳機，模擬北歐的互不打擾，練習「內省」；智利模式(OFF)在大自然中刻意拿下，練習「與世界連結」。",
                        icon: Headphones 
                    }
                ],
                missions: [
                    { 
                        name: "模組 A：挪威 (Norway)", 
                        code: "SYSTEM_AUDIT",
                        purpose: "觀察「社會秩序」的極致。學習「減法」與「無痛管理」。",
                        action: "帶著「審計筆記本」，記錄那些「看不見的規則」。體驗什麼叫「安靜的效率」。",
                        tasks: [
                            "腦內安裝：詹代法則 (Jante Law)。觀察「去階級化」的平等互動。",
                            "觀察動線：奧斯陸歌劇院如何用空間引導人群（不強制）。",
                            "體驗無人化：嘗試全程不開口完成交通/購物（體驗零摩擦力）。",
                            "視覺訓練：觀察建築的負空間 (Negative Space) 與留白。",
                            "感受邊界：在峽灣觀察水如何被山脈完美限制（物理隱喻）。"
                        ],
                        prep: "體能：日行 2萬步的城市耐久力。 資源：高門檻預算策略（買時間與體驗）。裝備：Gore-Tex (介面防護層) + 降噪耳機 (內在對話)。",
                        color: "text-emerald-400",
                        bg: "bg-emerald-950/30",
                        border: "border-emerald-500/20",
                        icon: Globe2
                    },
                    { 
                        name: "模組 B：智利 (Chile)", 
                        code: "ENERGY_GROUNDING",
                        purpose: "觀察「自然秩序」的極致。啟動「黃星星」圖騰，接引地氣。",
                        action: "在阿塔卡馬看星空（混亂中的秩序）。在百內塔看邊界（意志力的具象化）。",
                        tasks: [
                            "視覺衝擊：親眼見證「甲木（百內塔）」直插雲霄的震撼。",
                            "星空校準：在 ALMA 感受「混亂中的極致秩序」。",
                            "垂直深耕：在聖地牙哥感受被高山深海夾擊的能量。",
                            "空間校準：在 Google Earth 拉遠地圖，感受狹長國土的邊界感。"
                        ],
                        prep: "體能：負重深蹲、爬樓梯 (W Trek 準備)。 資源：提前半年搶訂山屋。 裝備：極致防曬與保濕 (抗火防燥) + 拿掉耳機 (外在連結)。",
                        color: "text-rose-400",
                        bg: "bg-rose-950/30",
                        border: "border-rose-500/20",
                        icon: Mountain
                    }
                ]
            },
            maintenance: {
                level1: {
                    title: "LEVEL 1: DAILY MAINTENANCE (日常維護)",
                    desc: "頻率：每日 | 時長：30-60 分鐘。目標：動態清理，並為遠程專案儲備能量。",
                    specs: "頻率：每日 | 時長：30-60 分鐘",
                    items: [
                        {
                            type: "物理釋放 (Physical Venting)",
                            target: "針對薦骨能量 (MG)",
                            action: "深蹲 20 分鐘 / Zone 2 快走。目的：把煩躁排出身體。",
                            link: "為 [智利] 儲備體能",
                            icon: BatteryCharging
                        },
                        {
                            type: "腦力導流 (Mental Channeling)",
                            target: "針對壬水思緒 (Scholar)",
                            action: "整理 Notion / 研究登山裝備。目的：把水導入木（建立微型秩序）。",
                            link: "為 [架構師] 累積底層邏輯",
                            icon: BrainCircuit
                        },
                        {
                            type: "感官隔離 (Sensory Isolation)",
                            target: "針對高敏特質 (HSP)",
                            action: "降噪耳機 / 獨處一小時 / 拒絕無效社交。目的：修復護盾。",
                            link: "模擬 [挪威] 低語境氛圍",
                            icon: Headphones
                        }
                    ]
                },
                level2: {
                    title: "LEVEL 2: LOCAL RESET (在地重組)",
                    desc: "目標：系統重啟 (Reboot)。離開日常環境，進行中度修復。",
                    specs: "頻率：每 1-3 個月 (每季) | 時長：3-4 天",
                    action: "地點：大叻 (Da Lat) 或高品質 Resort。策略：數位排毒，切斷工作訊號。重點不在觀光，在於「切換場景」以重置大腦。",
                    icon: Sofa
                },
                level3: {
                    title: "LEVEL 3: REMOTE CALIBRATION (遠程校準)",
                    desc: "目標：系統大更新 (Major Update)。下載環境參數，校準內在秩序。",
                    specs: "頻率：每 1-2 年 | 時長：10-14 天",
                    icon: Plane,
                    // project details are in pilotData.duality
                }
            },
            script: [
                { phase: "v1.0 (Debug)", time: "現在 (1-2年)", title: "轉型陣痛：編譯中", desc: "更換作業系統。忍受笨蛋與新技術的挫折 (React/BI)。每一次痛苦都是在為自動化寫代碼。任務：不要放棄轉型。" },
                { phase: "v1.1 (Refactor)", time: "未來 (3-5年)", title: "系統重構：自動化", desc: "數據成為武器。不再靠情緒罵人，而是用儀表板管理。身分轉變為「懂技術的商業權威」。" },
                { phase: "v1.2 (Legacy)", time: "晚年 (45+)", title: "生態系建立：水利工程", desc: "巨大的水庫灌溉森林。從勞力交換轉為「系統/知識授權」。留下方法論與SOP。" },
                { phase: "v2.0 (Next)", time: "未來版本", title: "版本繼承：優雅開局", desc: "今生修好的 Bug (能量控制)，是來世的預設功能。現在的修煉 (寫好 Code)，是為了下個版本的流暢運行。" },
                { phase: "FINAL CHECK (確認事項)", time: "當前狀態", title: "關於「北歐」的最終定論", desc: "北歐不再是「目的地」，而是「選修課」。你不需要移民去尋找秩序，因為你已經具備「建立秩序」的能力。你的系統就是你的護照。你已經自由了。", special: true }
            ]
        };

        // --- Main Component ---

        const App = () => {
            const [tab, setTab] = useState('rhythm'); // Default to Rhythm
            const [pilotTab, setPilotTab] = useState('core'); // core, path, maint, log
            const [showToolDetails, setShowToolDetails] = useState(false); // Toggle for tool details

            // Current Rhythm Phase Calculation
            const hour = new Date().getHours();
            let currentPhaseId = "rest";
            if (hour >= 9 && hour < 12) currentPhaseId = "deepWork";
            else if (hour >= 12 && hour < 14) currentPhaseId = "refuel";
            else if (hour >= 14 && hour < 18) currentPhaseId = "maneuver";

            // Checklist Logic (LocalStorage)
            const [checklistMode, setChecklistMode] = useState('takeoff');
            const [checkedItems, setCheckedItems] = useState({});
            
            // Handle pilot tab change from specs
            const handleSpecLink = (link) => {
                setTab('pilot');
                if (link.includes('CORE')) setPilotTab('core');
                else if (link.includes('PATH')) setPilotTab('path');
                else if (link.includes('MAINT')) setPilotTab('maint');
                else if (link.includes('LOG')) setPilotTab('log');
            };

            useEffect(() => {
                try {
                    const saved = localStorage.getItem('flight_manual_checklist');
                    const savedDate = localStorage.getItem('flight_manual_date');
                    const today = new Date().toDateString();
                    
                    if (saved && savedDate === today) {
                        setCheckedItems(JSON.parse(saved));
                    } else {
                        // Reset on new day
                        localStorage.setItem('flight_manual_date', today);
                        setCheckedItems({});
                    }
                } catch (e) {
                    console.error("Storage access error:", e);
                }
            }, []);

            const toggleCheck = (id) => {
                const newStatus = { ...checkedItems, [id]: !checkedItems[id] };
                setCheckedItems(newStatus);
                localStorage.setItem('flight_manual_checklist', JSON.stringify(newStatus));
            };

            return (
                <div className="min-h-screen p-4 md:p-6 pb-20 max-w-3xl mx-auto">
                    <div className="scan-line"></div>
                    
                    {/* Header */}
                    <header className="flex items-center justify-between mb-6 border-b border-sky-500/30 pb-4">
                        <div className="flex items-center gap-3">
                            <div className="p-2 bg-sky-500/10 rounded border border-sky-500/50">
                                <BookOpen className="text-sky-400" size={24} />
                            </div>
                            <div>
                                <h1 className="text-xl font-bold tracking-widest text-sky-400">FLIGHT MANUAL</h1>
                                <p className="text-[10px] text-slate-500">OPERATIONAL GUIDELINES</p>
                            </div>
                        </div>
                        <div className="flex items-center gap-2">
                            <div className="px-2 py-1 bg-emerald-500/10 border border-emerald-500/30 rounded text-[10px] text-emerald-400 font-bold flex items-center gap-1 animate-pulse">
                                <Target size={10} /> COURSE LOCKED
                            </div>
                            <div className="text-[10px] text-slate-500 font-mono">
                                v8.5.1 Fixed
                            </div>
                        </div>
                    </header>

                    {/* Navigation Tabs */}
                    <div className="grid grid-cols-4 gap-1 bg-slate-900/50 p-1 rounded-lg mb-8 border border-slate-800">
                        <button onClick={() => setTab('rhythm')} className={`py-2 rounded flex flex-col items-center justify-center gap-1 transition-all ${tab === 'rhythm' ? 'bg-sky-500/20 text-sky-400 shadow-lg shadow-sky-500/10' : 'text-slate-500 hover:text-slate-300'}`}>
                            <Activity size={16} />
                            <span className="text-[9px] font-bold">RHYTHM</span>
                        </button>
                        <button onClick={() => setTab('specs')} className={`py-2 rounded flex flex-col items-center justify-center gap-1 transition-all ${tab === 'specs' ? 'bg-indigo-500/20 text-indigo-400 shadow-lg shadow-indigo-500/10' : 'text-slate-500 hover:text-slate-300'}`}>
                            <Cpu size={16} />
                            <span className="text-[9px] font-bold">SPECS</span>
                        </button>
                        <button onClick={() => setTab('check')} className={`py-2 rounded flex flex-col items-center justify-center gap-1 transition-all ${tab === 'check' ? 'bg-emerald-500/20 text-emerald-400 shadow-lg shadow-emerald-500/10' : 'text-slate-500 hover:text-slate-300'}`}>
                            <ClipboardCheck size={16} />
                            <span className="text-[9px] font-bold">CHECK</span>
                        </button>
                        <button onClick={() => setTab('pilot')} className={`py-2 rounded flex flex-col items-center justify-center gap-1 transition-all ${tab === 'pilot' ? 'bg-rose-500/20 text-rose-400 shadow-lg shadow-rose-500/10' : 'text-slate-500 hover:text-slate-300'}`}>
                            <User size={16} />
                            <span className="text-[9px] font-bold">PILOT</span>
                        </button>
                    </div>

                    {/* Content Area */}
                    <main className="space-y-6">

                        {/* 1. RHYTHM */}
                        {tab === 'rhythm' && (
                            <div className="space-y-4 animate-in fade-in slide-in-from-bottom-4 duration-500">
                                {phases.map((p, i) => {
                                    const isCurrent = p.id === currentPhaseId;
                                    return (
                                        <div key={i} className={`p-5 rounded-xl border transition-all relative overflow-hidden ${isCurrent ? 'bg-slate-800/80 border-sky-500 ring-1 ring-sky-500/50 shadow-lg shadow-sky-500/10' : 'bg-slate-900/40 border-slate-800 opacity-60 hover:opacity-100 hover:border-slate-700'}`}>
                                            {isCurrent && <div className="absolute top-0 right-0 px-2 py-1 bg-sky-500 text-slate-900 text-[10px] font-bold">CURRENT PHASE</div>}
                                            <div className="flex items-start gap-4">
                                                <div className={`p-3 rounded-lg bg-slate-950 border border-slate-800 ${p.color}`}>
                                                    <p.icon size={24} />
                                                </div>
                                                <div className="flex-1">
                                                    <div className="flex justify-between items-center mb-1">
                                                        <h3 className={`font-bold text-base ${p.color}`}>{p.title}</h3>
                                                        <span className="text-xs text-slate-500 font-mono border border-slate-700 px-1.5 rounded">{p.time}</span>
                                                    </div>
                                                    <p className="text-sm text-slate-300 mb-4 leading-relaxed">{p.desc}</p>
                                                    
                                                    <div className="grid grid-cols-2 gap-4">
                                                        <div className="bg-slate-950/50 p-2 rounded border border-slate-800/50">
                                                            <span className="text-emerald-500 font-bold text-[10px] uppercase tracking-wider block mb-2 border-b border-emerald-500/20 pb-1">DO (執行)</span>
                                                            <ul className="text-xs text-slate-400 space-y-1">
                                                                {p.dos.map(d => <li key={d} className="flex items-start gap-1.5"><span className="text-emerald-500 mt-0.5">•</span>{d}</li>)}
                                                            </ul>
                                                        </div>
                                                        <div className="bg-slate-950/50 p-2 rounded border border-slate-800/50">
                                                            <span className="text-rose-500 font-bold text-[10px] uppercase tracking-wider block mb-2 border-b border-rose-500/20 pb-1">DON'T (避免)</span>
                                                            <ul className="text-xs text-slate-400 space-y-1">
                                                                {p.donts.map(d => <li key={d} className="flex items-start gap-1.5"><span className="text-rose-500 mt-0.5">•</span>{d}</li>)}
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        )}

                        {/* 2. SPECS */}
                        {tab === 'specs' && (
                            <div className="space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500">
                                <div className="grid grid-cols-1 gap-3">
                                    {specs.map((item, i) => (
                                        <div key={i} className="bg-slate-900/80 border border-slate-800 p-4 rounded-xl flex items-center gap-4 hover:border-indigo-500/30 transition-colors">
                                            <div className={`p-3 rounded-lg bg-slate-950 border border-slate-800 ${item.color}`}>
                                                <item.icon size={20} />
                                            </div>
                                            <div className="flex-1">
                                                <h4 className={`font-bold text-sm ${item.color} mb-1`}>{item.title}</h4>
                                                <p className="text-xs text-slate-400 leading-relaxed mb-2">{item.desc}</p>
                                                <button 
                                                    onClick={() => handleSpecLink(item.link)}
                                                    className="text-[10px] flex items-center gap-1 text-slate-500 hover:text-sky-400 transition-colors bg-slate-950/50 px-2 py-1 rounded border border-slate-800 w-fit"
                                                >
                                                    <Link size={10} /> {item.link}
                                                </button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                                
                                <div className="pt-4 border-t border-slate-800">
                                    <h3 className="text-xs font-bold text-slate-400 flex items-center gap-2 mb-4 uppercase tracking-wider">
                                        <Bug size={14} className="text-rose-500"/> System Diagnostics (自我診斷)
                                    </h3>
                                    <div className="space-y-4">
                                        {diagnostics.map((item, i) => (
                                            <div key={i} className="bg-slate-900 border border-slate-800 p-4 rounded-xl">
                                                <div className="flex items-start gap-3 mb-3">
                                                    <AlertCircle size={16} className="text-rose-400 mt-0.5 shrink-0" />
                                                    <p className="text-sm font-bold text-slate-200">"{item.obs}"</p>
                                                </div>
                                                <div className="pl-7 space-y-3">
                                                    <div className="text-xs text-indigo-300 bg-indigo-500/10 border border-indigo-500/20 p-2 rounded leading-relaxed">
                                                        <span className="font-bold block mb-1">ANALYSIS:</span>
                                                        {item.analysis}
                                                    </div>
                                                    <div className="flex items-start gap-2 text-xs text-emerald-400 font-bold bg-emerald-500/10 border border-emerald-500/20 p-2 rounded">
                                                        <CheckCircle size={14} className="mt-0.5 shrink-0"/>
                                                        <span>FIX: {item.fix}</span>
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* 3. CHECKLIST */}
                        {tab === 'check' && (
                            <div className="animate-in fade-in slide-in-from-bottom-4 duration-500">
                                <div className="flex gap-2 mb-6">
                                    <button onClick={() => setChecklistMode('takeoff')} className={`flex-1 py-3 text-xs font-bold rounded-lg border flex items-center justify-center gap-2 transition-all ${checklistMode === 'takeoff' ? 'bg-sky-500/10 border-sky-500 text-sky-400' : 'bg-slate-900 border-slate-800 text-slate-500'}`}>
                                        <PlaneTakeoff size={16} /> 啟動 (STARTUP)
                                    </button>
                                    <button onClick={() => setChecklistMode('landing')} className={`flex-1 py-3 text-xs font-bold rounded-lg border flex items-center justify-center gap-2 transition-all ${checklistMode === 'landing' ? 'bg-indigo-500/10 border-indigo-500 text-indigo-400' : 'bg-slate-900 border-slate-800 text-slate-500'}`}>
                                        <PlaneLanding size={16} /> 關閉 (SHUTDOWN)
                                    </button>
                                </div>

                                <div className="space-y-3">
                                    {Object.entries(checklistData[checklistMode]).map(([key, item]) => (
                                        <div 
                                            key={key} 
                                            onClick={() => toggleCheck(key)}
                                            className={`p-4 rounded-xl border flex items-center gap-4 cursor-pointer transition-all group ${checkedItems[key] ? 'bg-slate-900/30 border-slate-800 opacity-50' : 'bg-slate-800/40 border-slate-700 hover:border-sky-500/50 hover:bg-slate-800/60'}`}
                                        >
                                            <div className={`w-6 h-6 rounded flex items-center justify-center border transition-colors ${checkedItems[key] ? 'bg-emerald-500 border-emerald-500 text-slate-900' : 'border-slate-600 group-hover:border-sky-500'}`}>
                                                {checkedItems[key] && <CheckSquare size={14} strokeWidth={3} />}
                                            </div>
                                            <div className="flex-1">
                                                <h4 className={`font-bold text-sm mb-0.5 ${checkedItems[key] ? 'text-slate-500 line-through' : 'text-slate-200'}`}>{item.text}</h4>
                                                <p className="text-xs text-slate-500 font-mono">{item.subtext}</p>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                                <div className="mt-8 text-center text-[10px] text-slate-600 border-t border-slate-800/50 pt-4">
                                    * 狀態自動暫存於本機 (Local Storage)，無需連網。
                                </div>
                            </div>
                        )}

                        {/* 4. PILOT DASHBOARD (Refactored) */}
                        {tab === 'pilot' && (
                            <div className="space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500">
                                
                                {/* 4.0 Core Identity (Always Visible) */}
                                <div className="bg-slate-900/80 border border-rose-500/30 p-5 rounded-xl relative overflow-hidden">
                                    <div className="absolute top-0 right-0 p-2 opacity-10">
                                        <Fingerprint size={100} className="text-rose-500"/>
                                    </div>
                                    <div className="flex items-center gap-2 mb-3">
                                        <Fingerprint size={18} className="text-rose-400" />
                                        <h3 className="text-sm font-bold text-rose-400 tracking-wider">PILOT PROFILE</h3>
                                    </div>
                                    <h2 className="text-xl font-bold text-slate-100 mb-2">{pilotData.core.title}</h2>
                                    <p className="text-sm text-slate-400 leading-relaxed mb-4 whitespace-pre-wrap">{pilotData.core.desc}</p>
                                    <div className="flex gap-2">
                                        {pilotData.core.tags.map(tag => (
                                            <span key={tag} className="text-[10px] font-mono px-2 py-1 rounded bg-rose-500/10 border border-rose-500/20 text-rose-300">#{tag}</span>
                                        ))}
                                    </div>
                                </div>

                                {/* 4.x Sub-Navigation for Pilot */}
                                <div className="flex gap-2 border-b border-slate-800 pb-2 overflow-x-auto">
                                    <button onClick={() => setPilotTab('core')} className={`px-3 py-1.5 rounded-full text-[10px] font-bold transition-all whitespace-nowrap ${pilotTab === 'core' ? 'bg-rose-500 text-white' : 'bg-slate-800 text-slate-400 hover:bg-slate-700'}`}>CORE (核心)</button>
                                    <button onClick={() => setPilotTab('path')} className={`px-3 py-1.5 rounded-full text-[10px] font-bold transition-all whitespace-nowrap ${pilotTab === 'path' ? 'bg-sky-500 text-white' : 'bg-slate-800 text-slate-400 hover:bg-slate-700'}`}>PATH (航路)</button>
                                    <button onClick={() => setPilotTab('maint')} className={`px-3 py-1.5 rounded-full text-[10px] font-bold transition-all whitespace-nowrap ${pilotTab === 'maint' ? 'bg-teal-500 text-white' : 'bg-slate-800 text-slate-400 hover:bg-slate-700'}`}>MAINT (維護)</button>
                                    <button onClick={() => setPilotTab('log')} className={`px-3 py-1.5 rounded-full text-[10px] font-bold transition-all whitespace-nowrap ${pilotTab === 'log' ? 'bg-amber-500 text-white' : 'bg-slate-800 text-slate-400 hover:bg-slate-700'}`}>LOG (日誌)</button>
                                </div>

                                {/* 4.1 CORE TAB */}
                                {pilotTab === 'core' && (
                                    <div className="space-y-6 animate-in fade-in">
                                        {/* Kernel Layer (Yang Ren) */}
                                        <div className="bg-gradient-to-br from-rose-950/40 to-slate-900 border border-rose-500/50 p-5 rounded-xl shadow-lg shadow-rose-900/10">
                                            <div className="flex justify-between items-start mb-4">
                                                <div>
                                                    <div className="flex items-center gap-2 mb-1">
                                                        <Flame size={16} className="text-rose-500 animate-pulse" />
                                                        <h3 className="text-xs font-bold text-rose-400 tracking-[0.2em]">{pilotData.kernel.title}</h3>
                                                    </div>
                                                    <div className="text-[10px] font-mono text-rose-300/50">{pilotData.kernel.subtitle}</div>
                                                </div>
                                                <div className="px-2 py-1 bg-rose-500 text-slate-950 text-[10px] font-bold rounded animate-pulse">HIGH VOLTAGE</div>
                                            </div>
                                            <p className="text-sm text-slate-300 leading-relaxed mb-6 border-l-2 border-rose-500/50 pl-3">{pilotData.kernel.desc}</p>
                                            <div className="space-y-3">
                                                {pilotData.kernel.attributes.map((attr, i) => (
                                                    <div key={i} className="bg-slate-950/60 p-3 rounded border border-rose-500/20 flex flex-col gap-1">
                                                        <span className="text-rose-400 font-bold text-xs">{attr.label}</span>
                                                        <span className="text-xs text-slate-400">{attr.value}</span>
                                                    </div>
                                                ))}
                                            </div>
                                            <div className="mt-4 pt-3 border-t border-rose-500/20 text-xs flex items-start gap-2 text-rose-300/80 bg-rose-500/5 p-2 rounded">
                                                <Lock size={14} className="shrink-0 mt-0.5" />
                                                <span>{pilotData.kernel.solution}</span>
                                            </div>
                                        </div>

                                        {/* Maya Totem */}
                                        <div className="bg-yellow-950/30 border border-yellow-500/30 p-5 rounded-xl relative overflow-hidden">
                                            <div className="absolute top-0 right-0 p-2 opacity-10">
                                                <Sparkles size={80} className="text-yellow-500"/>
                                            </div>
                                            <div className="flex justify-between items-start mb-4">
                                                <div>
                                                    <div className="flex items-center gap-2 mb-1">
                                                        <Sparkles size={16} className="text-yellow-400 animate-pulse" />
                                                        <h3 className="text-xs font-bold text-yellow-400 tracking-[0.2em]">{pilotData.maya.title}</h3>
                                                    </div>
                                                </div>
                                            </div>
                                            <p className="text-sm text-slate-300 leading-relaxed mb-4">{pilotData.maya.desc}</p>
                                            <div className="flex items-start gap-2 bg-yellow-500/10 p-2 rounded border border-yellow-500/20 mb-2">
                                                <MapPin size={14} className="text-yellow-400 shrink-0 mt-0.5" />
                                                <div className="text-xs text-slate-400">
                                                    <span className="text-yellow-200 font-bold">能量場：{pilotData.maya.location}</span><br/>
                                                    {pilotData.maya.meaning}
                                                </div>
                                            </div>
                                        </div>

                                        {/* System Patches */}
                                        <div className="bg-emerald-950/20 border border-emerald-500/30 p-5 rounded-xl">
                                            <h3 className="text-emerald-400 font-bold text-sm mb-3 flex items-center gap-2">
                                                <ShieldCheck size={16} />
                                                {pilotData.patches.title}
                                            </h3>
                                            <p className="text-xs text-slate-400 mb-4">{pilotData.patches.desc}</p>
                                            <div className="space-y-3">
                                                {pilotData.patches.items.map((item, i) => (
                                                    <div key={i} className="bg-slate-950/60 p-3 rounded border border-emerald-500/20 relative overflow-hidden group">
                                                        <div className="absolute right-0 top-0 bg-emerald-500 text-slate-950 text-[9px] font-bold px-1.5 py-0.5 rounded-bl">{item.status}</div>
                                                        <div className="flex flex-col gap-2">
                                                            <div className="flex items-center gap-2">
                                                                <div className="w-1.5 h-1.5 rounded-full bg-rose-500"></div>
                                                                <span className="text-xs text-rose-400 line-through decoration-rose-500/50 decoration-2">{item.bug}</span>
                                                            </div>
                                                            <div className="flex items-center gap-2">
                                                                <div className="w-1.5 h-1.5 rounded-full bg-emerald-500"></div>
                                                                <span className="text-xs text-emerald-400 font-bold">{item.fix}</span>
                                                            </div>
                                                            <p className="text-xs text-slate-400 border-t border-emerald-500/10 pt-2 mt-1 leading-relaxed">{item.logic}</p>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* 4.2 PATH TAB */}
                                {pilotTab === 'path' && (
                                    <div className="space-y-6 animate-in fade-in">
                                        {/* Career Path */}
                                        <div className="bg-slate-900/50 border border-slate-800 p-5 rounded-xl">
                                            <div className="mb-4">
                                                <h4 className="font-bold text-sky-400 mb-1 flex items-center gap-2">
                                                    <GitBranch size={16}/> {pilotData.career.title}
                                                </h4>
                                                <p className="text-xs text-slate-400">{pilotData.career.desc}</p>
                                            </div>
                                            <div className="grid grid-cols-2 gap-3 mb-4">
                                                {pilotData.career.comparison.map((c, i) => (
                                                    <div key={i} className={`p-3 rounded border ${i === 0 ? 'bg-slate-950/50 border-slate-800 opacity-60' : 'bg-sky-950/20 border-sky-500/30'}`}>
                                                        <div className="text-[10px] font-mono text-slate-500 mb-1">{i === 0 ? 'DON\'T' : 'DO'}</div>
                                                        <div className={`font-bold text-sm mb-1 ${i === 0 ? 'text-slate-400' : 'text-sky-300'}`}>{c.role}</div>
                                                        <div className="text-[10px] text-slate-500">{c.feature}</div>
                                                        <div className={`text-[10px] font-bold mt-1 ${i === 0 ? 'text-rose-500' : 'text-emerald-500'}`}>{c.status}</div>
                                                    </div>
                                                ))}
                                            </div>
                                            <div className="border-t border-slate-800 pt-3">
                                                <div className="text-[10px] text-slate-500 mb-2 font-mono">ARCHETYPES (古代原型)</div>
                                                <div className="space-y-2">
                                                    {pilotData.career.archetypes.map((a, i) => (
                                                        <div key={i} className="flex items-baseline gap-2 text-xs">
                                                            <span className="text-indigo-400 font-bold whitespace-nowrap">[{a.name}]</span>
                                                            <span className="text-slate-400">{a.desc}</span>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        </div>

                                        {/* Side Quests */}
                                        <div className="bg-slate-950 border border-slate-800 p-5 rounded-xl">
                                            <h3 className="text-violet-400 font-bold text-sm mb-1 flex items-center gap-2">
                                                <Compass size={16} />
                                                {pilotData.sideQuests.title}
                                            </h3>
                                            <p className="text-xs text-slate-400 mb-4 leading-relaxed">{pilotData.sideQuests.desc}</p>
                                            <div className="space-y-3">
                                                {pilotData.sideQuests.items.map((item, i) => (
                                                    <div key={i} className="flex gap-3 bg-slate-900/50 p-3 rounded border border-slate-800 hover:border-violet-500/30 transition-colors">
                                                        <div className="flex flex-col items-center justify-center w-12 shrink-0 border-r border-slate-800 pr-3">
                                                            <div className="text-[10px] font-mono text-violet-300">MATCH</div>
                                                            <div className="text-lg font-bold text-violet-400">{item.match}</div>
                                                        </div>
                                                        <div>
                                                            <h4 className="font-bold text-slate-200 text-sm mb-1">{item.name}</h4>
                                                            <p className="text-xs text-slate-400 leading-relaxed">{item.desc}</p>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>

                                        {/* Decision Support */}
                                        <div className="grid grid-cols-1 gap-3">
                                            {pilotData.decision.cards.map((card, i) => (
                                                <div key={i} className={`bg-slate-900/80 border ${card.border} p-4 rounded-xl flex gap-4`}>
                                                    <div className={`p-2 rounded-lg h-fit ${card.bg} ${card.color}`}>
                                                        <card.icon size={20} />
                                                    </div>
                                                    <div>
                                                        <h4 className={`font-bold text-sm mb-1 ${card.color}`}>{card.title}</h4>
                                                        <p className="text-xs text-slate-400 leading-relaxed">{card.content}</p>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>

                                        {/* Alliance Protocol */}
                                        <div className="bg-pink-950/20 border border-pink-500/30 p-5 rounded-xl">
                                            <h3 className="text-pink-400 font-bold text-sm mb-1 flex items-center gap-2">
                                                <HeartHandshake size={16} />
                                                {pilotData.alliance.title}
                                            </h3>
                                            <p className="text-xs text-slate-400 mb-4 leading-relaxed">{pilotData.alliance.desc}</p>
                                            <div className="grid grid-cols-1 gap-3">
                                                {pilotData.alliance.strategies.map((s, i) => (
                                                    <div key={i} className="bg-slate-950/60 p-3 rounded border border-pink-500/20 flex gap-3">
                                                        <div className="p-2 bg-pink-500/10 rounded text-pink-400 h-fit">
                                                            <s.icon size={16} />
                                                        </div>
                                                        <div>
                                                            <h4 className="font-bold text-pink-300 text-xs mb-1">{s.title}</h4>
                                                            <p className="text-xs text-slate-400 leading-relaxed">{s.content}</p>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* 4.3 MAINT TAB (UI Optimized) */}
                                {pilotTab === 'maint' && (
                                    <div className="space-y-6 animate-in fade-in">
                                        
                                        {/* Level 1: Daily (Horizontal Layout) */}
                                        <div className="bg-teal-950/20 border border-teal-500/30 p-4 rounded-xl">
                                            <div className="flex justify-between items-center mb-3">
                                                <h3 className="text-teal-400 font-bold text-sm flex items-center gap-2">
                                                    <BatteryCharging size={16} />
                                                    {pilotData.maintenance.level1.title}
                                                </h3>
                                                <span className="text-[10px] font-mono text-teal-300 bg-teal-500/10 px-2 py-0.5 rounded border border-teal-500/20">
                                                    {pilotData.maintenance.level1.specs}
                                                </span>
                                            </div>
                                            <p className="text-xs text-slate-400 mb-3">{pilotData.maintenance.level1.desc}</p>
                                            
                                            <div className="grid grid-cols-1 md:grid-cols-3 gap-2">
                                                {pilotData.maintenance.level1.items.map((item, i) => (
                                                    <div key={i} className="bg-slate-900/60 p-3 rounded border border-teal-500/20 hover:border-teal-500/40 transition-colors flex flex-col justify-between h-full">
                                                        <div>
                                                            <div className="flex items-center gap-2 mb-1">
                                                                <item.icon size={14} className="text-teal-400" />
                                                                <h4 className="font-bold text-teal-200 text-xs">{item.type}</h4>
                                                            </div>
                                                            <p className="text-[10px] text-slate-400 leading-snug mb-2">{item.action}</p>
                                                        </div>
                                                        <div className="flex items-center gap-1 text-[9px] text-sky-400/80 bg-sky-500/5 px-1.5 py-0.5 rounded w-fit border border-sky-500/10 mt-auto">
                                                            <ArrowRight size={8} /> {item.link}
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>

                                        {/* Level 2: Local (Wide Card) */}
                                        <div className="bg-slate-900/50 border border-violet-500/30 p-4 rounded-xl flex flex-col md:flex-row gap-4 items-center md:items-start">
                                            <div className="p-3 bg-violet-500/10 rounded-full border border-violet-500/20 shrink-0">
                                                <Sofa size={24} className="text-violet-400" />
                                            </div>
                                            <div className="flex-1">
                                                <div className="flex justify-between items-start mb-1">
                                                    <h3 className="text-violet-300 font-bold text-sm">{pilotData.maintenance.level2.title}</h3>
                                                    <span className="text-[10px] font-mono text-violet-300/80 bg-violet-500/10 px-2 py-0.5 rounded border border-violet-500/20">
                                                        {pilotData.maintenance.level2.specs}
                                                    </span>
                                                </div>
                                                <p className="text-xs text-slate-400 mb-2">{pilotData.maintenance.level2.desc}</p>
                                                <div className="bg-slate-950/40 p-2 rounded border border-violet-500/10 text-xs text-slate-300">
                                                    {pilotData.maintenance.level2.action}
                                                </div>
                                            </div>
                                        </div>

                                        {/* Level 3: Remote (Project Duality - Expanded Cards) */}
                                        <div className="space-y-3">
                                            <div className="flex justify-between items-center px-1">
                                                <h3 className="text-sky-400 font-bold text-sm flex items-center gap-2">
                                                    <Plane size={16} />
                                                    {pilotData.maintenance.level3.title}
                                                </h3>
                                                <div className="text-[10px] font-mono text-sky-300 bg-sky-500/10 px-2 py-0.5 rounded border border-sky-500/20">
                                                    {pilotData.maintenance.level3.specs}
                                                </div>
                                            </div>

                                            {/* Mission Statement (Goal) */}
                                            <p className="text-xs text-slate-400 mb-1 leading-relaxed border-l-2 border-sky-500/50 pl-3">
                                                {pilotData.maintenance.level3.desc}
                                            </p>
                                            
                                            {/* Toolbag (Expandable) */}
                                            <div className="bg-slate-900/40 rounded border border-slate-700/50 overflow-hidden mb-3">
                                                <button 
                                                    onClick={() => setShowToolDetails(!showToolDetails)}
                                                    className="w-full flex items-center justify-between p-2 bg-slate-800/40 hover:bg-slate-800/60 transition-colors"
                                                >
                                                    <span className="text-[10px] font-bold text-slate-300 flex items-center gap-2">
                                                        <PenTool size={12} className="text-sky-400"/>
                                                        OBSERVATION TOOLBAG (觀察工具包)
                                                    </span>
                                                    {showToolDetails ? <ChevronUp size={12} className="text-slate-500"/> : <ChevronDown size={12} className="text-slate-500"/>}
                                                </button>
                                                
                                                {showToolDetails && (
                                                    <div className="p-3 grid grid-cols-1 md:grid-cols-2 gap-3 border-t border-slate-700/50 animate-in fade-in slide-in-from-top-1">
                                                        {pilotData.duality.tools.map((tool, i) => (
                                                            <div key={i} className="bg-slate-950/60 border border-slate-700/50 p-2 rounded">
                                                                <div className="flex items-center gap-2 mb-1">
                                                                    <div className="p-1 bg-sky-500/10 rounded text-sky-300">
                                                                        <tool.icon size={12} />
                                                                    </div>
                                                                    <div className="text-[11px] font-bold text-sky-200">{tool.name}</div>
                                                                </div>
                                                                <div className="text-[9px] font-mono text-slate-500 mb-1">{tool.desc}</div>
                                                                <p className="text-[10px] text-slate-400 leading-snug border-t border-slate-800 pt-1 mt-1">{tool.detail}</p>
                                                            </div>
                                                        ))}
                                                    </div>
                                                )}
                                                {!showToolDetails && (
                                                    <div className="px-3 py-1.5 flex gap-2 overflow-x-auto">
                                                         {pilotData.duality.tools.map((tool, i) => (
                                                            <div key={i} className="text-[9px] text-slate-500 border border-slate-700 px-2 py-0.5 rounded-full flex items-center gap-1 opacity-70">
                                                                <tool.icon size={8} /> {tool.name}
                                                            </div>
                                                         ))}
                                                    </div>
                                                )}
                                            </div>

                                            {/* Mission Cards */}
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                {pilotData.duality.missions.map((m, i) => (
                                                    <div key={i} className={`relative overflow-hidden p-4 rounded-xl border ${m.border} ${m.bg}`}>
                                                        <div className="flex items-center gap-2 mb-3 border-b border-white/10 pb-2">
                                                            <div className={`p-1.5 rounded-lg bg-black/20 ${m.color}`}>
                                                                <m.icon size={16} />
                                                            </div>
                                                            <div>
                                                                <h4 className={`font-bold text-sm ${m.color}`}>{m.name}</h4>
                                                                <div className="text-[9px] font-mono text-white/50">{m.code}</div>
                                                            </div>
                                                        </div>
                                                        
                                                        <div className="space-y-3">
                                                            <div>
                                                                <div className="text-[9px] font-bold text-white/40 uppercase tracking-wider mb-1">OBJECTIVE</div>
                                                                <p className="text-xs text-slate-200 leading-snug">{m.purpose}</p>
                                                            </div>
                                                            
                                                            <div>
                                                                <div className="text-[9px] font-bold text-white/40 uppercase tracking-wider mb-1">TASKS</div>
                                                                <ul className="text-xs text-slate-300 space-y-1">
                                                                    {m.tasks.map((t, idx) => (
                                                                        <li key={idx} className="flex items-start gap-1.5">
                                                                            <span className={`mt-1 w-1 h-1 rounded-full ${m.color} bg-current opacity-80`}></span>
                                                                            <span className="opacity-90">{t}</span>
                                                                        </li>
                                                                    ))}
                                                                </ul>
                                                            </div>

                                                            <div className="bg-black/20 p-2 rounded text-[10px] text-slate-400 border border-white/5">
                                                                <span className="font-bold text-slate-300">PREP: </span>
                                                                {m.prep}
                                                            </div>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>

                                        {/* General Strategy (Footer) */}
                                        <div className="text-center pt-4 border-t border-slate-800">
                                            <p className="text-[10px] text-slate-500 font-mono">SYSTEM MAINTENANCE STRATEGY v1.0</p>
                                            <div className="flex justify-center gap-4 mt-2">
                                                 <div className="text-[10px] text-slate-600 flex items-center gap-1"><Wrench size={10}/> Regular Check</div>
                                                 <div className="text-[10px] text-slate-600 flex items-center gap-1"><Info size={10}/> Preventive Action</div>
                                            </div>
                                        </div>

                                    </div>
                                )}

                                {/* 4.4 LOG TAB */}
                                {pilotTab === 'log' && (
                                    <div className="space-y-6 animate-in fade-in">
                                        <div className="flex items-center gap-2 px-1 border-b border-slate-800 pb-2 mb-2">
                                            <History size={16} className="text-amber-400" />
                                            <h3 className="text-xs font-bold text-slate-400 tracking-wider">FLIGHT LOG (航行日誌)</h3>
                                        </div>
                                        <div className="relative border-l border-slate-800 ml-3 space-y-6 py-2">
                                            {pilotData.script.map((s, i) => (
                                                <div key={i} className="pl-6 relative group">
                                                    <div className={`absolute -left-[5px] top-1 w-2.5 h-2.5 rounded-full border-2 ${i === 0 ? 'bg-amber-500 border-amber-500 animate-pulse' : i === 3 ? 'bg-slate-900 border-indigo-500' : 'bg-slate-900 border-slate-600'}`}></div>
                                                    <div className="flex items-baseline gap-2 mb-1">
                                                        <span className={`text-[10px] font-mono px-1.5 rounded border ${i === 0 ? 'bg-amber-500/10 text-amber-400 border-amber-500/30' : i === 3 ? 'bg-indigo-500/10 text-indigo-400 border-indigo-500/30' : 'bg-slate-800 text-slate-500 border-slate-700'}`}>{s.phase}</span>
                                                        <span className="text-[10px] text-slate-600">{s.time}</span>
                                                    </div>
                                                    <h4 className={`font-bold text-sm mb-1 ${i === 0 ? 'text-slate-200' : 'text-slate-400'}`}>{s.title}</h4>
                                                    <p className="text-xs text-slate-500 leading-relaxed group-hover:text-slate-300 transition-colors">{s.desc}</p>
                                                    {s.special && (
                                                        <div className="mt-2 text-[10px] text-emerald-400 border-t border-slate-700/50 pt-2 flex items-center gap-1.5">
                                                            <Check size={10} /> {s.desc}
                                                        </div>
                                                    )}
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                            </div>
                        )}

                    </main>
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
